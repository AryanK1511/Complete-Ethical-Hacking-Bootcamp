# Exploitation and Gaining Access

## What is Exploitation?

- Information gathering, scanning, and vulnerability analysis must be completed
- Target information obtained: open/closed ports, services, versions, OS details, vulnerabilities

### Exploitation Process

#### 1. Assess Target Vulnerabilities

- Identify key vulnerabilities from reconnaissance:
  - Outdated operating systems (e.g., unpatched Windows 10)
  - Vulnerable software running on specific ports
  - Misconfigured services

#### 2. Exploit the Target

- Exploitation: Using discovered vulnerabilities to deliver a payload
- Payload: A program delivered to the target after exploitation
- Common payload type: A shell that allows command execution on the target system

#### 3. Command Execution Flow

1. Exploit the vulnerability and send the payload
2. Payload executes on the target machine
3. Target connects back to the attacker's machine (Kali Linux)
4. Attacker sends commands to be executed on the target
5. Target returns command output to the attacker

### Alternative Approach: When No Vulnerabilities Exist

#### Social Engineering

- Used when technical vulnerabilities are not present
- Requires tricking the user into executing the payload themselves
- Delivery methods:
  - Malicious email attachments disguised as legitimate files
  - Spoofed emails appearing to come from trusted sources
  - Physical methods like infected USB drives (higher risk)

### Metasploit Framework

- Primary tool for exploitation
- Contains thousands of pre-built exploits
- Already included in Kali Linux

## What is a Vulnerability?

- A vulnerability is a weakness or bug in software code that can be exploited
- Software is created by developers using various programming languages (Python, Java, C, etc.)
- Once deployed, software with vulnerabilities can be exploited if exposed to the internet

### Technical Vulnerabilities

- Occur when software is accessible through open ports (FTP, SSH, HTTP, etc.)
- Bugs in code can sometimes be critical, allowing attackers to manipulate the software
- An "exploitable vulnerability" allows attackers to make software act in unintended ways
- Once exploited, attackers typically deploy a payload or shell to gain control

### Vulnerability Classifications

- **CVE (Common Vulnerabilities and Exposures)**: Standard naming convention for publicly known vulnerabilities

  - Format: CVE-[Year]-[Number]

- **Zero Day**: A vulnerability that exists but hasn't yet been patched by vendors
  - Can sometimes be exploited for months before discovery
  - Example: EternalBlue exploit (used in WannaCry ransomware attack in 2017)
    - Originally created and used by NSA
    - Leaked and subsequently used in widespread attacks
    - Targeted hospitals, police stations, and other critical infrastructure

### Human Vulnerabilities (Social Engineering)

- Often more accessible than technical vulnerabilities
- Example scenario:
  1. Company with excellent technical security measures (no technical vulnerabilities)
  2. Employee "John" receives spoofed email appearing to be from a colleague
  3. Email contains an image of cars (a topic of interest to John)
  4. Image opens normally but runs malicious code in the background
  5. John's computer becomes compromised without his knowledge
  6. Attacker can then move laterally through the network

## Understanding Shells in Exploitation

### Types of Shells

#### Reverse Shell

- The primary type of shell used in exploitation
- **Working Principle**: Target machine connects back to the attacker's machine
- **Process**:
  1. Attacker sets up a listener on their Kali Linux machine on a specific port
  2. Target is exploited and the payload (shell) is delivered
  3. The payload instructs the target to connect to the attacker's listening port
  4. Once connection is established, attacker can control the target machine
- **Advantage**: Bypasses most firewalls since outbound connections are usually allowed

#### Bind Shell

- **Working Principle**: Target machine opens a port that waits for the attacker to connect
- **Process**:
  1. Target is exploited and the payload (shell) is delivered
  2. The payload opens a port on the target machine and listens for connections
  3. Attacker connects to this open port on the target
  4. Once connection is established, attacker can control the target machine
- **Disadvantage**: Often blocked by firewalls that prevent unauthorized ports from being opened

### Why Reverse Shells Are Preferred

- Firewalls typically block inbound connections but allow outbound connections
- Similar to how a target connecting to a website works (outbound connections)
- More reliable in real-world scenarios
- Can bypass Network Address Translation (NAT) and similar network configurations

## Introduction to Metasploit Framework

- Metasploit Framework is a powerful tool for exploiting vulnerabilities in various operating systems (Windows, MacOS, Linux).
- It contains thousands of exploits, but also includes several other modules essential for penetration testing.

### Seven Modules in Metasploit Framework

1. **Exploits** – Execute a sequence of commands targeting a specific vulnerability.
2. **Payloads** – Code that runs on a target system after exploitation.
3. **Auxiliary Modules** – Perform actions like scanning, fuzzing, and denial-of-service (DoS) attacks.
4. **Encoders** – Help evade antivirus detection by encoding payloads.
5. **Evasion Modules** – Specifically designed to bypass security defenses.
6. **Nops** – No-operation instructions used in buffer overflow exploits.
7. **Post Exploitation Modules** – Used after an exploit to gather information or escalate privileges.

### Navigating the Metasploit Framework Directory

- **Change directory to Metasploit:** `cd /usr/share/metasploit-framework`
- **List files:** `ls`
- **Run Metasploit:** `msfconsole`
- **Generate payloads:** `msfvenom`

### Understanding Metasploit Modules

#### 1. Exploits

- **Exploits target vulnerabilities** in operating systems, applications, and network services.
- Categories include:
  - Windows, Linux, MacOS exploits
  - Web application exploits
  - Buffer overflow and code injection exploits
- **Example:** `cd modules/exploits/windows`
- Subcategories include:
  - FTP, Firewall, SMTP, SMB, HTTP exploits
- Exploits are written in **Ruby (.rb files)**.
- To inspect an exploit: `nano exploit_name.rb`

#### 2. Auxiliary Modules

- Used for **scanning, fuzzing, DoS attacks, and vulnerability fingerprinting**.
- Examples:
  - **Sniffer module:** Captures network traffic.
  - **Spoofing module:** Spoofs ARP, DNS, and mDNS.
- To navigate:
  - `cd modules/auxiliary`
  - `cd sniffer`
  - `ls`

#### 3. Post Exploitation Modules

- Used **after** gaining access to a system.
- Examples:
  - **Gathering:** Extract saved passwords, dump hashes.
  - **Privilege Escalation:** Gain administrative/root access.
  - **WLAN Post-Exploitation:** Extract Wi-Fi passwords.
- Navigation:
  - `cd modules/post`
  - `ls`

#### 4. Payloads

- Payloads **allow interaction with exploited machines**.
- Three categories:
  - **Singles:** Standalone actions (e.g., adding a user, running a script).
  - **Stagers:** Establish a connection between attacker and target.
  - **Stages:** Provide extended functionality (e.g., full command shell, Meterpreter shell).
- **Meterpreter Shell:**
  - Advanced shell that allows file uploads, screenshots, microphone recording, webcam activation, etc.
- Common payload:
  - **Reverse TCP Meterpreter Shell** (`reverse_tcp` payload)
- Navigation:
  - `cd modules/payloads`
  - `cd stagers/windows`
  - `ls`

#### 5. Encoders

- Help evade **antivirus detection**.
- Encode payloads to **reduce signature-based detection**.
- Not very effective anymore as antivirus programs recognize them.
- Navigation:
  - `cd modules/encoders`

#### 6. Evasion Modules

- Specifically designed to **bypass Windows Defender**.
- Many evasion modules have become ineffective due to updates in Windows security.
- Navigation:
  - `cd modules/evasion/windows`

#### 7. Nops (No Operations)

- Used in **buffer overflow exploits**.
- Allocate space in memory before executing payloads.
- **NOPs (No Operation instructions)** are primarily used in low-level Assembly programming.
- Navigation:
  - `cd modules/nops`
